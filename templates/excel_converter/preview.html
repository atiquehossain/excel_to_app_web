{% extends "base.html" %}
{% load custom_filters %}
{% load static %}

{% block title %}Preview Generated Code - Excel to Dart Code Generator{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-b from-gray-50 to-white dark:from-gray-900 dark:to-gray-800 text-gray-900 dark:text-gray-100">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-6xl mx-auto">
            <!-- Header Section -->
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400">
                    Code Preview
                </h1>
                
                <!-- Theme Toggle -->
                <button id="theme-toggle" class="p-3 rounded-full bg-white dark:bg-gray-700 shadow-lg hover:shadow-xl transition-all duration-300">
                    <svg id="light-icon" class="w-6 h-6 hidden text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/>
                    </svg>
                    <svg id="dark-icon" class="w-6 h-6 hidden text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
                    </svg>
                </button>
            </div>
            
            <!-- App Info Card -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 mb-8 transform hover:scale-[1.02] transition-all duration-300">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800 dark:text-gray-200">Generated App Details</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-xl">
                        <p class="font-medium text-gray-600 dark:text-gray-300 mb-2">App Name</p>
                        <p class="text-lg text-gray-800 dark:text-gray-100">{{ app_name }}</p>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-xl">
                        <p class="font-medium text-gray-600 dark:text-gray-300 mb-2">Ideal Sheet</p>
                        <p class="text-lg text-gray-800 dark:text-gray-100">{{ ideal_sheet }}</p>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-xl">
                        <p class="font-medium text-gray-600 dark:text-gray-300 mb-2">Selected Sheets</p>
                        <div class="text-lg text-gray-800 dark:text-gray-100">
                            {% for file in generated_files %}
                            <span class="inline-block bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded px-2 py-1 text-sm mr-2 mb-2">{{ file.sheet }}</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tab Navigation -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-8">
                <div class="border-b border-gray-200 dark:border-gray-700">
                    <nav class="flex flex-wrap -mb-px space-x-1" aria-label="Tabs">
                        <!-- Tab buttons with enhanced styling -->
                        <button 
                            class="px-6 py-4 text-sm font-medium rounded-t-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                            onclick="showPreviewTab('home-code')"
                            id="home-code-tab"
                        >
                            Home Page
                        </button>
                        <button 
                            class="px-6 py-4 text-sm font-medium rounded-t-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                            onclick="showPreviewTab('models')"
                            id="models-tab"
                        >
                            Models
                        </button>
                        <button 
                            class="px-6 py-4 text-sm font-medium rounded-t-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                            onclick="showPreviewTab('language-keys')"
                            id="language-keys-tab"
                        >
                            Language Keys
                        </button>
                        <button 
                            class="px-6 py-4 text-sm font-medium rounded-t-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                            onclick="showPreviewTab('key-values')"
                            id="key-values-tab"
                        >
                            Key Values
                        </button>
                        <button 
                            class="px-6 py-4 text-sm font-medium rounded-t-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                            onclick="showPreviewTab('setup-data')"
                            id="setup-data-tab"
                        >
                            Setup Data
                        </button>
                        <button 
                            class="px-6 py-4 text-sm font-medium rounded-t-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                            onclick="showPreviewTab('ui-code')"
                            id="ui-code-tab"
                        >
                            UI Code
                        </button>
                        <button 
                            class="px-6 py-4 text-sm font-medium rounded-t-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                            onclick="showPreviewTab('list-code')"
                            id="list-code-tab"
                        >
                            List Page
                        </button>
                    </nav>
                </div>
                
                <!-- Tab Content Container -->
                <div class="mt-6">
                    <!-- Keep existing tab content divs but add transitions -->
                    <div id="models-content" class="tab-content transition-opacity duration-300">
                        <div class="mb-4">
                            <h2 class="text-xl font-semibold">Generated Models</h2>
                        </div>
                        
                        <!-- Model Files Navigation -->
                        <div class="border-b border-gray-200 mb-4">
                            <nav class="flex space-x-4" aria-label="Model Tabs">
                                {% for file in generated_files %}
                                <button 
                                    class="px-3 py-2 text-sm font-medium rounded-t-lg hover:bg-gray-100 
                                           {% if forloop.first %}bg-gray-100 border-b-2 border-blue-500{% endif %}"
                                    onclick="showModelTab('{{ file.class_name }}')"
                                >
                                    {{ file.sheet }}
                                </button>
                                {% endfor %}
                            </nav>
                        </div>
                        
                        <!-- Model Code Content -->
                        {% for file in generated_files %}
                        <div id="model-{{ file.class_name }}" 
                             class="model-content {% if not forloop.first %}hidden{% endif %}">
                            <div class="bg-gray-800 dark:bg-gray-900 rounded-lg p-4 overflow-x-auto relative">
                                <div class="absolute top-2 right-2 flex gap-2">
                                    <button onclick="downloadCode(this, '{{ file.class_name }}.dart')" class="px-2 py-1 text-sm bg-blue-600 hover:bg-blue-500 text-white rounded">
                                        Download
                                    </button>
                                    <button onclick="copyCode(this)" class="px-2 py-1 text-sm bg-gray-700 hover:bg-gray-600 text-white rounded">
                                        Copy
                                    </button>
                                </div>
                                <pre class="text-white"><code>{{ file.generated_code|default:"// Code will be generated here" }}</code></pre>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div id="language-keys-content" class="tab-content hidden transition-opacity duration-300">
                        <div class="mb-4">
                            <h2 class="text-xl font-semibold">Language Keys</h2>
                        </div>
                            <div class="bg-gray-800 dark:bg-gray-900 rounded-lg p-4 overflow-x-auto relative">
                                <div class="absolute top-2 right-2 flex gap-2">
                                    <button onclick="downloadCode(this, 'language_keys.dart')" class="px-2 py-1 text-sm bg-blue-600 hover:bg-blue-500 text-white rounded">
                                        Download
                                    </button>
                                    <button onclick="copyCode(this)" class="px-2 py-1 text-sm bg-gray-700 hover:bg-gray-600 text-white rounded">
                                        Copy
                                    </button>
                                </div>
                                <pre class="text-white"><code>abstract class Languages {
{% for file in generated_files %}
  // {{ file.sheet }} Questions
  {% if file.questions %}
    {% for question in file.questions %}
  String get {{ question.key }};  // {{ question.question }}
    {% endfor %}
  {% endif %}

  // {{ file.sheet }} Fields
  {% if file.fields %}
    {% for field in file.fields %}
  String get {{ field.key }};  // {{ field.field }}
    {% endfor %}
  {% endif %}
{% endfor %}
}</code></pre>
                            </div>
                    </div>
                    
                    <div id="key-values-content" class="tab-content hidden transition-opacity duration-300">
                        <div class="mb-4">
                            <h2 class="text-xl font-semibold">Key Value Pairs</h2>
                        </div>
                            <div class="bg-gray-800 dark:bg-gray-900 rounded-lg p-4 overflow-x-auto relative">
                                <div class="absolute top-2 right-2 flex gap-2">
                                    <button onclick="downloadCode(this, 'key_values.dart')" class="px-2 py-1 text-sm bg-blue-600 hover:bg-blue-500 text-white rounded">
                                        Download
                                    </button>
                                    <button onclick="copyCode(this)" class="px-2 py-1 text-sm bg-gray-700 hover:bg-gray-600 text-white rounded">
                                        Copy
                                    </button>
                                </div>
                                <pre class="text-white"><code>abstract class Languages {
{% for file in generated_files %}
  // {{ file.sheet }} Questions
  {% if file.questions %}
    {% for question in file.questions %}
  String get {{ question.key }} => "{{ question.question }}";
    {% endfor %}
  {% endif %}

  // {{ file.sheet }} Fields
  {% if file.fields %}
    {% for field in file.fields %}
  String get {{ field.key }} => "{{ field.field }}";
    {% endfor %}
  {% endif %}

{% endfor %}
}</code></pre>
                            </div>
                    </div>
                    
                    <div id="setup-data-content" class="tab-content hidden transition-opacity duration-300">
                        <div class="mb-4">
                            <h2 class="text-xl font-semibold">Setup Data</h2>
                        </div>
                            <div class="bg-gray-800 dark:bg-gray-900 rounded-lg p-4 overflow-x-auto relative">
                                <div class="absolute top-2 right-2 flex gap-2">
                                    <button onclick="downloadCode(this, 'setup_data.dart')" class="px-2 py-1 text-sm bg-blue-600 hover:bg-blue-500 text-white rounded">
                                        Download
                                    </button>
                                    <button onclick="copyCode(this)" class="px-2 py-1 text-sm bg-gray-700 hover:bg-gray-600 text-white rounded">
                                        Copy
                                    </button>
                                </div>
                                <pre class="text-white"><code>class SetupConstant {
{% for file in generated_files %}{% if file.questions %}{% for question in file.questions %}{% if question.field_type|lower == 'radio' or question.field_type|lower == 'dropdown' or question.field_type|lower == 'multiple choice' or question.field_type|lower == 'multiple-choice' or question.field_type|lower == 'multiplechoice' %}
  static const String {{ question.database }}_{{ file.class_name }}_SetupConstant = "{{ question.database }}_{{ file.class_name }}_SetupConstant";{% endif %}{% endfor %}{% endif %}{% endfor %}
}

class SetupData {
  static List<SetupModel> _getData(
    BuildContext context,
    String modelName,
  ) {
    List<SetupModel> items = [];
    
    // Using if-else chain for model name checking
    if (false) { /* placeholder for first condition */ }
{% for file in generated_files %}{% if file.questions %}{% for question in file.questions %}{% if question.field_type|lower == 'radio' or question.field_type|lower == 'dropdown' or question.field_type|lower == 'multiple choice' or question.field_type|lower == 'multiple-choice' or question.field_type|lower == 'multiplechoice' %}
    else if (modelName == SetupConstant.{{ question.database }}_{{ file.class_name }}_SetupConstant) {
      // Setup data for {{ question.database }}{% regroup file.fields|dictsort:"database_value" by database_value as fields_by_database %}{% for db_group in fields_by_database %}{% if db_group.grouper == question.database %}{% for field in db_group.list %}
      items.add(SetupModel(Languages.getText(context)!.{{ field.key }}, "{{ forloop.counter }}"));{% endfor %}{% endif %}{% endfor %}
    }{% endif %}{% endfor %}{% endif %}{% endfor %}
    
    return items;
  }
  
  static List<SetupModel> getDropDownItems(BuildContext context, String modelName) {
    return _getData(context, modelName);
  }
}</code></pre>
                            </div>
                    </div>
                    
                    <div id="ui-code-content" class="tab-content hidden transition-opacity duration-300">
                        <div class="mb-4">
                            <h2 class="text-xl font-semibold">UI Implementation</h2>
                        </div>
                        
                        <!-- UI Files Navigation -->
                        <div class="border-b border-gray-200 mb-4">
                            <nav class="flex space-x-4" aria-label="UI Tabs">
                                {% for file in generated_files %}
                                <button 
                                    class="px-3 py-2 text-sm font-medium rounded-t-lg hover:bg-gray-100 
                                           {% if forloop.first %}bg-gray-100 border-b-2 border-blue-500{% endif %}"
                                    onclick="showUITab('{{ file.class_name }}')"
                                >
                                    {{ file.sheet }}
                                </button>
                                {% endfor %}
                            </nav>
                        </div>
                        
                        <!-- UI Code Content -->
                        {% for file in generated_files %}
                        <div id="ui-{{ file.class_name }}" 
                             class="ui-content {% if not forloop.first %}hidden{% endif %}">
                            <div class="bg-gray-800 dark:bg-gray-900 rounded-lg p-4 overflow-x-auto relative">
                                <div class="absolute top-2 right-2 flex gap-2">
                                    <button onclick="downloadCode(this, '{{ file.class_name|lower }}_ui.dart')" class="px-2 py-1 text-sm bg-blue-600 hover:bg-blue-500 text-white rounded">
                                        Download
                                    </button>
                                    <button onclick="copyCode(this)" class="px-2 py-1 text-sm bg-gray-700 hover:bg-gray-600 text-white rounded">
                                        Copy
                                    </button>
                                </div>
                                <pre class="text-white"><code>
import 'package:flutter/material.dart';


class {{ file.class_name }}UI extends StatefulWidget {
  @override
  _{{ file.class_name }}UIState createState() => _{{ file.class_name }}UIState();
}




class _{{ file.class_name }}UIState extends State<{{ file.class_name }}UI> {


   {{ file.class_name }} {{ file.class_name|stringformat:"s"|lower }} = {{ file.class_name }}();

   List numbers = [{% if file.questions %}{% for question in file.questions %}{{ question.question_no|default:forloop.counter }},{% endfor %}{% endif %}];

  @override
  void didChangeDependencies() {
    super.didChangeDependencies();
  }

  @override
  void initState() {
    super.initState();
  }


  @override
  Widget build(BuildContext context) {
    return SafeArea(
      child: Scaffold(
        appBar: AppBar(
          title: Text("{{ file.class_name }}"),
        ),
        body: Padding(
          padding: const EdgeInsets.all(16.0),
          child: SingleChildScrollView(
            child: Column(
              children: [
              {% if file.questions %}
              {% for question in file.questions %}
              /// Number = {{ question.question_no|default:forloop.counter }}
              {{ file.class_name }}Data(
                number: {{ question.question_no|default:forloop.counter }},
                condition: numbers.contains({{ question.question_no|default:forloop.counter }}),
                widget: {{ file.class_name }}Widget(
                  question: Languages.getText(context)!.{{ question.key }},
                  {% if question.field_type|lower == 'radio' or question.field_type|lower == 'radio button' %}
                  fieldType: AppConstant.FieldType_radio,
                  {% elif question.field_type|lower == 'dropdown' %}
                  fieldType: AppConstant.FieldType_dropdown,
                  {% elif question.field_type|lower == 'multiple choice' or question.field_type|lower == 'multiple-choice' or question.field_type|lower == 'multiplechoice' %}
                  fieldType: AppConstant.FieldType_multiple_choice,
                  {% elif question.field_type|lower == 'number' or question.field_type|lower == 'numeric' %}
                  fieldType: AppConstant.FieldType_NumberText,
                  keyboardType: TextInputType.number,
                  {% elif question.field_type|lower == 'date' or question.field_type|lower == 'datetime' %}
                  fieldType: AppConstant.FieldType_date,
                  {% elif question.field_type|lower == 'image' or question.field_type|lower == 'photo' %}
                  fieldType: AppConstant.FieldType_Image,
                  {% elif question.field_type|lower == 'pdf' %}
                  fieldType: AppConstant.FieldType_PDF,
                  {% else %}
                  fieldType: AppConstant.FieldType_EditText,
                  {% endif %}
                  field: {{ file.class_name|stringformat:"s"|lower }}.{{ question.database }},  <!-- Added field property here -->
                  dataList: {% if question.field_type|lower == 'number' or question.field_type|lower == 'text' or question.field_type|lower == 'pdf' %}null{% else %}SetupData.getDropDownItems(context, SetupConstant.{{ question.database }}_{{ file.class_name }}_SetupConstant){% endif %},
                  onChanged: (value) {
                      {{ file.class_name|stringformat:"s"|lower }}.{{ question.database }} = value;
                  },
                ),
              ),
              {% endfor %}
{% endif %}

          
              ],
            ),
          ),
        ),
      ),
    );
  }


    Widget {{ file.class_name }}Data({required int number,required bool condition,required Widget widget,})
    {
        if (condition) {
        return GestureDetector(
            onDoubleTap: () {
            // Show a toast message
          //  Operations.makeSnackBar(backgroundColor: Colors.white, context, " number: ${number.toString()}");
            },
            child: widget,
        );
        } else {
        return SizedBox.shrink();
        }
    }
  }
  class {{ file.class_name }}Widget extends StatelessWidget {

    final String question;
    final String fieldType;
    final Function onChanged;
    final dynamic dataList;
    var field;
    final dynamic? selectedOptionValuesTextsField;
    AppColor? appColor;
    final bool? textFieldEditable;
    String? fileNameField;
    String? fileTypeField;
    String? fileDateField;
    String? userId;
    String? photoType;
    final FocusNode? focusNode; // Optional FocusNode added
    final TextInputType keyboardType; // Default TextInputType is required
    
  
  
    {{ file.class_name }}Widget({
  
      required this.question,
      required this.fieldType,
      this.dataList,
      required this.onChanged,
      required this.field,
      this.selectedOptionValuesTextsField,
      this.appColor,
      this.textFieldEditable,
      this.fileDateField,
      this.fileNameField,
      this.fileTypeField,
      this.userId,
      this.photoType = AppConstant.PHOTO_HOUSE_LEFT,
      this.focusNode, // Initialize optional FocusNode
      this.keyboardType = TextInputType.text, // Default value set to TextInputType.text
      
  
  
    });
  
    @override
    Widget build(BuildContext context) {
    AppColor appColor = AppColor();
  
  
      return Padding(
        padding: const EdgeInsets.symmetric(vertical: 8.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
  
            GestureDetector(
              onLongPress: () {
                Clipboard.setData(ClipboardData(text: question));
                ScaffoldMessenger.of(context).showSnackBar(
                  const SnackBar(content: Text('Question copied to clipboard!')),
                );
              },
              child: Padding(
                padding: const EdgeInsets.only(left: 8.0, bottom: 4.0),
                child: Text(
                  question,
                  style: TextStyle(
                    fontSize: AppDimens.getTextSize(textSizeType: TextSizeType.normal),
                    letterSpacing: AppDimens.getTextLetterSpacing(),
                    color: appColor.H1_Title_Text,
                  ),
                ),
              ),
            ),
  
            if (fieldType == AppConstant.FieldType_dropdown)
              DropdownAAP(
                items: dataList,
                showMandatoryStar: false,
                selectedOptionValue: field,
                dropdownType: DropdownType.simple,
                borderColor: appColor.H1_Title_Text,
                textColor: appColor.H1_Title_Text,
                normalColor: appColor.Background,
               // itemsBackground: appColor!.Disabled_Background,
              //  background: appColor!.Disabled_Background as Color,
                onChange: onChanged,
              )
            else if (fieldType == AppConstant.FieldType_NumberText)
              Padding(
                padding: const EdgeInsets.all( 8.0),
                child: NewTextFieldAAP(
                  labelText: "",
                  initialValue: field,
                  borderRadius: 10,
                 // focusNode: focusNode, // Assign the FocusNode
                  keyboardType: keyboardType, // Assign the KeyboardType
                  isEnable: textFieldEditable ?? true,
                  validator: (value) {
                    if (value == null || value.isEmpty) {
                      return 'Please enter your value';
                    }
                    return null;
                  },
                  onChanged: (value) {
                    onChanged(value);
                  },
                ),
              )
            else if (fieldType == AppConstant.FieldType_radio)
                RadioGroupAAP(
                  radioGroupType: RadioGroupType.simple,
                  direction: Axis.vertical,
                  selectedOptionValue: field,
                  list: dataList,
                  borderColor: AppColor.border_color,
                  onChange: onChanged,
                )
              else if (fieldType == AppConstant.FieldType_multiple_choice)
                  MultipleChoiceAAP(
                    checkList: dataList,
                    textColor: appColor.H1_Title_Text,
                    checkBoxColor: appColor.Warning_Text,
                    borderColor: appColor.H1_Title_Text,
                    backgroundColor: appColor.Disabled_Background,
                   // appColor: appColor,
                    selectedOptionValues: field,
                    onChange: (value) => onChanged.call(value),
                    fontSize: AppDimens.getTextSize(
                        textSizeType: TextSizeType.normal),
                  )
  
                  else if (fieldType ==  AppConstant.FieldType_Image)
                      FilePickerGeneralAAP(
                        appColor: appColor,
                        uploadType: UploadType.Base64,
                        pickerType: PickerType.Image,
                        field: field,
                        borderColor: appColor.H1_Title_Text,
  
                        background: appColor.Disabled_Background as Color,
                        fileNameField: fileNameField,
                        fileTypeField: fileTypeField,
                        fileDateField: fileDateField,
  
                        fileStoragePath: getFileStoragePath(userId: userId, photoType: photoType ),
                        //fieldTitle: 'dbuivsahvfhsv bvgidsbvfi jgfty',
                        //dialogSubtitle: "bjbscjvd",
                        //dialogTitle: "eeeeeeee",
                        dialogIconPath: "assets/images/papers.png",
  
                        onChange: (filename, filePath, fileType, file, date) {
                          onChanged(filename, filePath, fileType, file, date);
                                              },
                      ),
          ],
        ),
      );
    }
  }
</code></pre>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <div id="list-code-content" class="tab-content hidden transition-opacity duration-300">
                <div class="mb-4">
                    <h2 class="text-xl font-semibold">List Page Implementation</h2>
                </div>
                
                <!-- List Page Files Navigation -->
                <div class="border-b border-gray-200 mb-4">
                    <nav class="flex space-x-4" aria-label="List Page Tabs">
                        {% for file in generated_files %}
                        <button 
                            class="px-3 py-2 text-sm font-medium rounded-t-lg hover:bg-gray-100 
                                   {% if forloop.first %}bg-gray-100 border-b-2 border-blue-500{% endif %}"
                            onclick="showListTab('{{ file.class_name }}')"
                        >
                            {{ file.sheet }}
                        </button>
                        {% endfor %}
                    </nav>
                </div>
                
                <!-- List Page Code Content -->
                {% for file in generated_files %}
                <div id="list-{{ file.class_name }}" 
                     class="list-content {% if not forloop.first %}hidden{% endif %}">
                    <div class="bg-gray-800 dark:bg-gray-900 rounded-lg p-4 overflow-x-auto relative">
                        <div class="absolute top-2 right-2 flex gap-2">
                            <button onclick="downloadCode(this, '{{ file.class_name|lower }}_list.dart')" class="px-2 py-1 text-sm bg-blue-600 hover:bg-blue-500 text-white rounded">
                                Download
                            </button>
                            <button onclick="copyCode(this)" class="px-2 py-1 text-sm bg-gray-700 hover:bg-gray-600 text-white rounded">
                                Copy
                            </button>
                        </div>
<pre class="text-white"><code>
import 'dart:async';

import 'package:flutter/material.dart';


import '{{file.class_name|lower}}UI.dart';

class {{file.class_name}}ListPage extends StatefulWidget {
  @override
  _{{file.class_name}}ListPageState createState() => _{{file.class_name}}ListPageState();
}

class _{{file.class_name}}ListPageState extends State<{{file.class_name}}ListPage> {
  late DatabaseManager manager;
  late DataSourceAAP dataSource;
  final SearchController searchController = SearchController();
  Timer? _debounce;
  late AppColor appColor;

  @override
  void initState() {
    super.initState();
    manager = DatabaseManager();
    dataSource = _buildDataSource('');
    searchController.addListener(_onSearchChanged);
    _load{{file.class_name}}s();
  }

  Future _load{{file.class_name}}s() async {}

  void _onSearchChanged() {
    if (_debounce?.isActive ?? false) _debounce?.cancel();
    _debounce = Timer(const Duration(milliseconds: 100), () {
      dataSource = _buildDataSource(searchController.text);
      setState(() {});
    });
  }

  DataSourceAAP _buildDataSource(String searchTerm) {
    return DataSourceAAP(
      modelList: <dynamic>[],
      select: "SELECT * FROM {{file.class_name}}",
      type: SourceType.local,
    );
  }

  @override
  Widget build(BuildContext context) {
    appColor = AppColor();
    return PageUF(
      appBar: AppBar(
        title: Text("{{file.class_name}} List"),
      ),
      body: Column(
        children: [
          Padding(
            padding: const EdgeInsets.all(16.0),
            child: SearchBar(
              shape: WidgetStateProperty.all<OutlinedBorder>(RoundedRectangleBorder(
                borderRadius: BorderRadius.all(Radius.circular(8.0)),
              )),
              controller: searchController,
              hintText: 'Search',
              leading: Icon(
                Icons.search,
                color: appColor.H1_Title_Text,
              ),
              backgroundColor: WidgetStateProperty.all(AppColor.white),
              surfaceTintColor: WidgetStateProperty.all(AppColor.blackColor),
              textStyle: WidgetStatePropertyAll(TextStyle(color: Colors.black)),
              padding: const WidgetStatePropertyAll<EdgeInsets>(
                EdgeInsets.symmetric(horizontal: 16.0),
              ),
            ),
          ),
          Expanded(
            child: _buildResultsList(),
          ),
        ],
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: () {
          Navigator.of(context).push(MaterialPageRoute(builder: (context) => {{file.class_name}}UI()));
        },
        child: Icon(Icons.add),
      ),
    );
  }

  Widget _buildResultsList() {
    return ListViewAAP(
      dataSource: dataSource,
      selfScroll: true,
      builder: (model, index) => _buildListItem(model),
      onTap: (model, index) => _navigateToDetail(model),
    );
  }

  Widget _buildListItem(Map<String, dynamic> model) {
    return Card(
      margin: const EdgeInsets.all(8.0),
      color: appColor.Disabled_Background,
      child: Padding(
        padding: const EdgeInsets.all(12.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [],
        ),
      ),
    );
  }

  void _navigateToDetail(Map<String, dynamic> model) {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => {{file.class_name}}UI(),
      ),
    );
  }
}

                        
</code></pre>
                    </div>
                </div>
                {% endfor %}
            </div>

            <div id="home-code-content" class="tab-content hidden transition-opacity duration-300">
                <div class="mb-4">
                    <h2 class="text-xl font-semibold">Home Page Implementation</h2>
                </div>
                
                <div class="bg-gray-800 dark:bg-gray-900 rounded-lg p-4 overflow-x-auto relative">
                    <div class="absolute top-2 right-2 flex gap-2">
                        <button onclick="downloadCode(this, 'home_page.dart')" class="px-2 py-1 text-sm bg-blue-600 hover:bg-blue-500 text-white rounded">
                            Download
                        </button>
                        <button onclick="copyCode(this)" class="px-2 py-1 text-sm bg-gray-700 hover:bg-gray-600 text-white rounded">
                            Copy
                        </button>
                    </div>
                    <pre class="text-white"><code>import 'package:flutter/material.dart';

class HomePage extends StatelessWidget {
  const HomePage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: EdgeInsets.symmetric(horizontal: 16.0),
      child: Column(
        children: [
          {% for file in generated_files %}
          HorizontalCard(
            icon: Icons.event,
            title: '{{ file.class_name }}ListPage',
            color: Colors.purple,
            onTap: () {
              Navigator.of(context).push(MaterialPageRoute(builder: (context) => {{ file.class_name }}ListPage()));
            },
          ),
          SizedBox(height: 20),
          {% endfor %}
        ],
      ),
    );
  }
}

class HorizontalCard extends StatelessWidget {
  final IconData icon;
  final String title;
  final Color color;
  final VoidCallback? onTap;

  const HorizontalCard({
    Key? key,
    required this.icon,
    required this.title,
    required this.color,
    this.onTap,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTap: onTap, 
      child: Container(
        padding: const EdgeInsets.all(18),
        decoration: BoxDecoration(
          color: Colors.white,
          borderRadius: BorderRadius.circular(20),
          boxShadow: [
            BoxShadow(
              color: Colors.grey.withOpacity(0.1),
              spreadRadius: 1,
              blurRadius: 10,
              offset: const Offset(0, 4),
            ),
          ],
        ),
        child: Row(
          children: [
            // Text Content
            Expanded(
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(
                    title,
                    style: TextStyle(
                      fontSize: 18,
                      fontWeight: FontWeight.w700,
                      color: Colors.grey[800],
                      letterSpacing: -0.2,
                    ),
                  ),
                  const SizedBox(height: 6),
                ],
              ),
            ),
            // Chevron with Background
            Container(
              width: 30,
              height: 30,
              decoration: const BoxDecoration(
                color: Colors.black,
                shape: BoxShape.circle,
              ),
              child: Icon(
                icon,
                size: 14,
                color: Colors.white,
              ),
            ),
          ],
        ),
      ),
    );
  }
}</code></pre>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showPreviewTab(tabName) {
    // Hide all tab content
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
    });
    
    // Show selected tab content
    document.getElementById(`${tabName}-content`).classList.remove('hidden');
    
    // Update tab button styles
    document.querySelectorAll('nav button').forEach(button => {
        button.classList.remove('bg-gray-100', 'border-b-2', 'border-blue-500');
    });
    document.getElementById(`${tabName}-tab`).classList.add('bg-gray-100', 'border-b-2', 'border-blue-500');
}

function showModelTab(className) {
    // Hide all model content
    document.querySelectorAll('.model-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Show selected model content
    document.getElementById(`model-${className}`).classList.remove('hidden');
    
    // Update model tab button styles
    document.querySelectorAll('nav[aria-label="Model Tabs"] button').forEach(button => {
        button.classList.remove('bg-gray-100', 'border-b-2', 'border-blue-500');
    });
    event.currentTarget.classList.add('bg-gray-100', 'border-b-2', 'border-blue-500');
}

function downloadAll() {
    var files = JSON.parse('{{ generated_files|safe|escapejs }}');
    var fileNames = files.map(function(f) { return f.class_name + '.dart'; });
    var url = "{% url 'excel_converter:download_all' %}?files=" + encodeURIComponent(JSON.stringify(fileNames));
    window.location.href = url;
}

function showUITab(className) {
    // Hide all UI content
    document.querySelectorAll('.ui-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Show selected UI content
    document.getElementById(`ui-${className}`).classList.remove('hidden');
    
    // Update UI tab button styles
    document.querySelectorAll('nav[aria-label="UI Tabs"] button').forEach(button => {
        button.classList.remove('bg-gray-100', 'border-b-2', 'border-blue-500');
    });
    event.currentTarget.classList.add('bg-gray-100', 'border-b-2', 'border-blue-500');
}

function showListTab(className) {
    // Hide all list content
    document.querySelectorAll('.list-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Show selected list content
    document.getElementById(`list-${className}`).classList.remove('hidden');
    
    // Update list tab button styles
    document.querySelectorAll('nav[aria-label="List Page Tabs"] button').forEach(button => {
        button.classList.remove('bg-gray-100', 'border-b-2', 'border-blue-500');
    });
    event.currentTarget.classList.add('bg-gray-100', 'border-b-2', 'border-blue-500');
}

function copyCode(button) {
    const preElement = button.closest('.bg-gray-800').querySelector('pre');
    const text = preElement.textContent;
    
    navigator.clipboard.writeText(text).then(() => {
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.classList.add('bg-green-500');
        
        setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('bg-green-500');
        }, 2000);
    }).catch(err => {
        console.error('Failed to copy text: ', err);
        button.textContent = 'Failed to copy';
        button.classList.add('bg-red-500');
        
        setTimeout(() => {
            button.textContent = 'Copy Code';
            button.classList.remove('bg-red-500');
        }, 2000);
    });
}

function downloadCode(button, filename) {
    // Get the code content from the pre tag
    const codeElement = button.closest('.relative').querySelector('pre code');
    const codeContent = codeElement.textContent;
    
    // Create a blob with the code content
    const blob = new Blob([codeContent], { type: 'text/plain' });
    
    // Create a temporary link element
    const link = document.createElement('a');
    link.href = window.URL.createObjectURL(blob);
    link.download = filename;
    
    // Append link to body, click it, and remove it
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Clean up the URL object
    window.URL.revokeObjectURL(link.href);
}

// Check for saved theme preference, otherwise use system preference
if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark');
    document.getElementById('light-icon').classList.remove('hidden');
} else {
    document.documentElement.classList.remove('dark');
    document.getElementById('dark-icon').classList.remove('hidden');
}

// Theme toggle button functionality
const themeToggle = document.getElementById('theme-toggle');
const darkIcon = document.getElementById('dark-icon');
const lightIcon = document.getElementById('light-icon');

themeToggle.addEventListener('click', () => {
    // Toggle theme
    document.documentElement.classList.toggle('dark');
    
    // Update icons
    darkIcon.classList.toggle('hidden');
    lightIcon.classList.toggle('hidden');
    
    // Save preference
    if (document.documentElement.classList.contains('dark')) {
        localStorage.theme = 'dark';
    } else {
        localStorage.theme = 'light';
    }
});

// Add transition classes
document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.add('transition-all', 'duration-300', 'ease-in-out');
});
</script>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/preview.js' %}"></script>
{% endblock %} 